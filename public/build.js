Player=function(a,b,c,d){var e=300,f=30,g=20,h=20,i=-700,j=300;this.dashing=!1,this.dashMeter=0;var k=1500;this.socketId=d,this.lastCollidedWith=null,this.score=0,this.paused=!1,Phaser.Sprite.call(this,a,b,c,"chicken"),a.physics.arcade.enable(this),this.body.gravity.y=1300,this.anchor.setTo(.5,.5),this.animations.add("walking",[6,7,8,9,10,11,12,13,14,15,16,17],10,!0),this.animations.add("flying",[18,19,20,21,22,23],10,!0),this.animations.add("pecking",[0,1,2,3,4,5]),this.scale.setTo(2,2),this.body.setSize(this.body.width-16,this.body.height-10,0,4),this.checkWorldBounds=!0,d||(this.outOfBoundsKill=!0,currentChicken=this,this.events.onKilled.add(function(){console.log("Woe is me!!!");var b=a.add.bitmapText(-250,0,"carrier_command","YOU DIED",50);b.lifespan=1500,a.time.events.add(1e3,function(){socket.emit("death",{killer:currentChicken.lastCollidedWith})})})),this.moveLeft=function(){this.body.velocity.x>-e&&(this.body.velocity.x-=this.body.touching.down?f:g,this.scale.x=2)},this.moveRight=function(){this.body.velocity.x<e&&(this.body.velocity.x+=this.body.touching.down?f:g,this.scale.x=-2)},this.decelerate=function(){this.body.velocity.x<0?this.body.touching.down&&(this.body.velocity.x=Math.min(this.body.velocity.x+h,0)):this.body.velocity.x>0?this.body.touching.down&&(this.body.velocity.x=Math.max(this.body.velocity.x-h,0)):this.body.touching.down&&(this.frame=0)},this.jump=function(){this.body.velocity.y=i,this.animations.stop(),this.frame=24},this.stopJump=function(){this.body.velocity.y<0&&this.body.velocity.y>i+j&&(this.body.velocity.y=0)},this.dash=function(){var a=player.scale.x>0?1:-1;player.body.velocity.x+=-a*this.dashMeter,this.dashMeter=0,this.animations.play("flying")},this.chargeDash=function(){this.dashMeter<k/3?(this.dashMeter+=6,this.tint=16777215):this.dashMeter<2*k/3?(this.dashMeter+=4,this.tint=16764159):this.dashMeter<k?(this.dashMeter+=2,this.tint=16751103):this.tint=16738047},this.setLevel=function(a){var b=.25*a+1;e=300*b,f=30*b,g=20*b,deceleration=20*b,i=-700*Math.sqrt(b)},console.log("player made")},Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player;var preload=function(){game.load.bitmapFont("carrier_command","assets/fonts/bitmapFonts/carrier_command.png","assets/fonts/bitmapFonts/carrier_command.xml"),game.load.spritesheet("chicken","assets/Chicken.png",32,32),game.load.image("cloud","assets/cloud-platform.png"),game.load.image("platform","assets/platform.png"),game.load.image("background","assets/forest.png"),game.load.image("lava","assets/lava.png"),game.stage.smoothed=!1,game.stage.backgroundColor="#141B2D"},bpmText,create=function(){var a=[[0,-200,"platform",2],[-450,-25,"platform",2],[450,-25,"platform",2],[0,-75,"cloud",1],[0,100,"platform",2],[200,200,"cloud",1],[-200,200,"cloud",1],[0,300,"cloud",1],[400,350,"platform",2],[-400,350,"platform",2]];game.world.setBounds(-2e3,-2e3,4e3,4e3),game.time.desiredFps=45,game.camera.x=-game.camera.width/2,game.camera.y=-game.camera.height/2,game.physics.startSystem(Phaser.Physics.ARCADE);var b=game.add.graphics(0,0);b.beginFill(14492160,1),b.drawRect(-2e3,0,4e3,4e3),b.endFill(),background=game.add.tileSprite(-2e3,-400,4e3,400,"background"),background.scale.x=2,background.scale.y=2,lava=game.add.tileSprite(-2e3,365,4e3,180,"lava"),lava.scale.x=1;var c=10;bmpText=game.add.bitmapText(-game.camera.width/2+c,-game.camera.height/2+c,"carrier_command","Move: arrow keys\n\nJump: SPACEBAR\n\nDash: C",17),game.time.events.add(6e3,function(){game.add.tween(bmpText).to({y:-170},1500,Phaser.Easing.Linear.None,!0),game.add.tween(bmpText).to({alpha:0},1500,Phaser.Easing.Linear.None,!0)},this),player=new Player(game,0,0,!1),game.add.existing(player),lava.bringToTop(),otherChickens={},socket.on("newLocation",function(a){player=new Player(game,a.x,a.y,!1),game.add.existing(player),lava.bringToTop()}),socket.on("sync",function(a){if(!game.paused){var b=Object.keys(a);b.forEach(function(b){b!==socket.id?otherChickens[b]?syncExistingChicken(otherChickens[b],a[b]):addNewChicken(b,a[b]):player.score!==a[b].kills&&(player.score=a[b].kills,upgradeChicken(player,player.score))});for(var c in otherChickens)-1===b.indexOf(c)&&(otherChickens[c].body.moves=!0,delete otherChickens[c]);socket.emit("sync",{PX:player.x,PY:player.y,VX:player.body.velocity.x,VY:player.body.velocity.y,dashBool:dashButton.isDown})}}),platforms=game.add.group(),platforms.enableBody=!0,a.forEach(function(a){var b=platforms.create(a[0],a[1],a[2]);b.scale.x=a[3],b.scale.y=a[3],b.anchor.setTo(.5,.5),b.body.immovable=!0}),jumpButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),dashButton=game.input.keyboard.addKey(Phaser.Keyboard.C),dashButton.onDown.add(function(){player.dash()},this);var d=250;game.camera.follow(player),game.camera.deadzone=new Phaser.Rectangle(d,d,game.camera.width-2*d,game.camera.height-2*d),game.camera.focusOnXY(0,0),cursors=game.input.keyboard.createCursorKeys(),game.onPause.add(pauseGame,this),game.onResume.add(resumeGame,this)},pauseGame=function(){socket.emit("pause")},resumeGame=function(){socket.emit("resume")},upgradeChicken=function(a,b){a.setLevel(b)},syncExistingChicken=function(a,b){b.paused?(a.tint=7368816,a.body.moves=!1,a.paused=!0):(a.body.moves=!0,a.paused=!1,a.x=b.positionX,a.y=b.positionY,a.body.velocity.x=b.velocityX,a.body.velocity.y=b.velocityY,a.score!==b.kills&&(a.score=b.kills,upgradeChicken(a,b.kills)))},addNewChicken=function(a,b){newChicken=new Player(game,b.positionX,b.positionY,a),game.add.existing(newChicken),otherChickens[a]=newChicken,otherChickens[a].score=b.kills,upgradeChicken(otherChickens[a],b.kills),lava.bringToTop()};syncTimer=0;var syncRate=2,stopping=null,stoppingTime=-100,update=function(){if(player){var a=game.add.bitmapText(-100,-game.camera.height/2+30,"carrier_command","SCORE:"+player.score,30);a.lifespan=1}game.physics.arcade.collide(player,platforms),game.physics.arcade.overlap(player,platforms,function(a,b){var c=b.top-a.height/2-5;a.y=c});for(var b in otherChickens)otherChickens[b].paused||(game.physics.arcade.collide(otherChickens[b],player,collideChickens),game.physics.arcade.collide(otherChickens[b],platforms),addAnimations(otherChickens[b]));cursors.left.isDown?player.moveLeft():cursors.right.isDown?player.moveRight():player.decelerate(),player.body.touching.down&&(0!==player.body.velocity.x?dashButton.isDown||player.animations.play("walking"):player.frame=0),jumpButton.isDown&&player.body.touching.down?player.jump():jumpButton.isDown||player.body.touching.down||player.stopJump(),player.chargeDash()},collideChickens=function(a,b){if(!a.paused){b.lastCollidedWith=a.socketId;var c,d;a.x>b.x?(c=a,d=b):(c=b,d=a);var e=a.body.velocity.x+b.body.velocity.x;e>0?(c.body.velocity.x=1.5*c.body.velocity.x,stopping=d):(d.body.velocity.x=1.5*d.body.velocity.x,stopping=c),stopping.body.velocity.x=0,stoppingTime=syncTimer}},addAnimations=function(a){var b=0===a.body.velocity.x?0:a.body.velocity.x>0?1:-1;0!==b&&(a.scale.x=b>0?-Math.abs(a.scale.x):Math.abs(a.scale.x)),0!==a.body.velocity.y?(a.animations.stop(),a.frame=24):0!==a.body.velocity.x?a.animations.play(a.dashing?"flying":"walking"):a.frame=0},sendSync=function(){socket.emit("sync",{PX:player.x,PY:player.y,VX:player.body.velocity.x,VY:player.body.velocity.y,dashBool:dashButton.isDown})};socket=io.connect();var game=new Phaser.Game(window.innerWidth,window.innerHeight,Phaser.AUTO,"",{preload:preload,create:create,update:update});